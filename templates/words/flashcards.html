{% extends 'base.html' %}

{% block title %}Flashcards - WordMaster{% endblock %}

{% block content %}
<div class="flashcards-header">
    <h1>Flashcards</h1>
    <p>Kelimeleri öğrenmek için kartları çevirin. İlerlemenizi takip edin ve düzenli tekrar yapın.</p>
</div>

{% if words %}
<div class="flashcards-container">
    <div class="flashcards-progress">
        <div class="progress-bar">
            <div class="progress-fill" style="width: 0%"></div>
        </div>
        <div class="progress-text">0 / {{ words|length }}</div>
    </div>
    
    <div class="flashcards-deck">
        {% for word in words %}
        <div class="flashcard" data-id="{{ word.id }}" {% if not forloop.first %}style="display: none;"{% endif %}>
            <div class="flashcard-inner">
                <div class="flashcard-front">
                    <div class="flashcard-content">
                        <h2>{{ word.word }}</h2>
                        {% if word.example %}
                        <p class="flashcard-example">{{ word.example }}</p>
                        {% endif %}
                    </div>
                    <div class="flashcard-footer">
                        <p>Çevirmek için tıklayın</p>
                    </div>
                </div>
                <div class="flashcard-back">
                    <div class="flashcard-content">
                        <h2>{{ word.translation }}</h2>
                    </div>
                    <div class="flashcard-footer">
                        <p>Bu kelimeyi biliyor musunuz?</p>
                        <div class="flashcard-actions">
                            <button class="btn btn-outline btn-sm flashcard-again">Tekrar Göster</button>
                            <button class="btn btn-primary btn-sm flashcard-know">Biliyorum</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div class="flashcards-navigation">
        <button class="btn btn-outline btn-lg" id="prevCard" disabled>
            <i class="fas fa-arrow-left"></i> Önceki
        </button>
        <button class="btn btn-primary btn-lg" id="nextCard">
            Sonraki <i class="fas fa-arrow-right"></i>
        </button>
    </div>
    
    <div class="flashcards-complete" style="display: none;">
        <h2>Tebrikler!</h2>
        <p>Tüm flashcardları tamamladınız.</p>
        <div class="complete-actions">
            <a href="{% url 'flashcards' %}" class="btn btn-outline">Tekrar Başlat</a>
            <a href="{% url 'word_list' %}" class="btn btn-primary">Kelimelerime Dön</a>
        </div>
    </div>
</div>
{% else %}
<div class="empty-state">
    <img src="/static/images/empty-state.svg" alt="Henüz kelime eklenmemiş">
    <h2>Çalışacak kelime bulunamadı</h2>
    <p>Flashcard çalışması yapmak için kelime ekleyin.</p>
    <a href="{% url 'word_list' %}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Kelime Ekle
    </a>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const flashcards = document.querySelectorAll('.flashcard');
        const progressFill = document.querySelector('.progress-fill');
        const progressText = document.querySelector('.progress-text');
        const prevButton = document.getElementById('prevCard');
        const nextButton = document.getElementById('nextCard');
        const flashcardsComplete = document.querySelector('.flashcards-complete');
        
        let currentIndex = 0;
        let completedCards = 0;
        
        // Initialize progress
        updateProgress();
        
        // Flip card on click
        flashcards.forEach(card => {
            card.addEventListener('click', function() {
                this.classList.toggle('flipped');
            });
            
            // Handle "Know" button
            const knowButton = card.querySelector('.flashcard-know');
            if (knowButton) {
                knowButton.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent card flip
                    completedCards++;
                    updateProgress();
                    goToNextCard();
                });
            }
            
            // Handle "Again" button
            const againButton = card.querySelector('.flashcard-again');
            if (againButton) {
                againButton.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent card flip
                    goToNextCard();
                });
            }
        });
        
        // Navigation buttons
        if (prevButton) {
            prevButton.addEventListener('click', goToPrevCard);
        }
        
        if (nextButton) {
            nextButton.addEventListener('click', goToNextCard);
        }
        
        function goToNextCard() {
            if (currentIndex < flashcards.length - 1) {
                flashcards[currentIndex].classList.remove('flipped');
                flashcards[currentIndex].style.display = 'none';
                currentIndex++;
                flashcards[currentIndex].style.display = 'block';
                updateNavButtons();
            } else {
                // All cards completed
                flashcards[currentIndex].style.display = 'none';
                flashcardsComplete.style.display = 'block';
            }
        }
        
        function goToPrevCard() {
            if (currentIndex > 0) {
                flashcards[currentIndex].classList.remove('flipped');
                flashcards[currentIndex].style.display = 'none';
                currentIndex--;
                flashcards[currentIndex].style.display = 'block';
                updateNavButtons();
            }
        }
        
        function updateNavButtons() {
            prevButton.disabled = currentIndex === 0;
            nextButton.disabled = currentIndex === flashcards.length - 1;
        }
        
        function updateProgress() {
            const percentage = (completedCards / flashcards.length) * 100;
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = `${completedCards} / ${flashcards.length}`;
        }
    });
</script>
{% endblock %}

{% block styles %}
<style>
    .flashcards-header {
        text-align: center;
        margin-bottom: 40px;
    }
    
    .flashcards-header h1 {
        margin-bottom: 10px;
        color: var(--dark);
    }
    
    .flashcards-header p {
        color: var(--gray);
        max-width: 600px;
        margin: 0 auto;
    }
    
    .flashcards-container {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .flashcards-progress {
        margin-bottom: 30px;
    }
    
    .progress-bar {
        height: 8px;
        background-color: var(--light-gray);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 10px;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(to right, var(--primary), var(--secondary));
        border-radius: 4px;
        transition: width 0.3s ease;
    }
    
    .progress-text {
        text-align: center;
        font-size: 0.9rem;
        color: var(--gray);
    }
    
    .flashcards-deck {
        perspective: 1000px;
        min-height: 300px;
        margin-bottom: 30px;
    }
    
    .flashcard {
        width: 100%;
        height: 300px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.6s;
    }
    
    .flashcard.flipped {
        transform: rotateY(180deg);
    }
    
    .flashcard-inner {
        position: relative;
        width: 100%;
        height: 100%;
        text-align: center;
        transform-style: preserve-3d;
    }
    
    .flashcard-front, .flashcard-back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 30px;
    }
    
    .flashcard-front {
        background-color: var(--white);
        border-top: 4px solid var(--primary);
    }
    
    .flashcard-back {
        background-color: var(--white);
        transform: rotateY(180deg);
        border-top: 4px solid var(--secondary);
    }
    
    .flashcard-content {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    
    .flashcard-content h2 {
        font-size: 2rem;
        margin-bottom: 15px;
        color: var(--dark);
    }
    
    .flashcard-example {
        font-style: italic;
        color: var(--gray);
    }
    
    .flashcard-footer {
        margin-top: 20px;
    }
    
    .flashcard-footer p {
        color: var(--gray);
        margin-bottom: 10px;
    }
    
    .flashcard-actions {
        display: flex;
        justify-content: center;
        gap: 15px;
    }
    
    .flashcards-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
    }
    
    .flashcards-complete {
        text-align: center;
        padding: 40px 0;
    }
    
    .flashcards-complete h2 {
        font-size: 2rem;
        margin-bottom: 15px;
        color: var(--dark);
    }
    
    .flashcards-complete p {
        color: var(--gray);
        margin-bottom: 30px;
    }
    
    .complete-actions {
        display: flex;
        justify-content: center;
        gap: 15px;
    }
    
    .btn-sm {
        padding: 8px 16px;
        font-size: 0.9rem;
    }
</style>
{% endblock %}