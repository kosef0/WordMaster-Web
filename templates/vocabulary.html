{% extends "base.html" %}

{% block content %}
<section class="vocabulary-container">
    <div class="vocabulary-header fadeIn">
        <h2><i class="fas fa-book"></i> Kelime Hazinem</h2>
        <p>Kişisel sözlüğünüzü yönetin ve öğrenme ilerlemenizi takip edin.</p>
    </div>

    <div class="vocabulary-stats fadeIn delay-100">
        <div class="stat-card pulse">
            <div class="stat-icon"><i class="fas fa-book-open"></i></div>
            <div class="stat-value">{{ words|length }}</div>
            <div class="stat-label">Toplam Kelime</div>
        </div>
        <div class="stat-card pulse">
            <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
            <div class="stat-value">{{ words|selectattr('learned', 'eq', true)|list|length }}</div>
            <div class="stat-label">Öğrenilen</div>
        </div>
        <div class="stat-card pulse">
            <div class="stat-icon"><i class="fas fa-graduation-cap"></i></div>
            <div class="stat-value">{{ words|selectattr('learned', 'eq', false)|list|length }}</div>
            <div class="stat-label">Öğreniliyor</div>
        </div>
    </div>

    <div class="vocabulary-actions fadeIn delay-200">
        <a href="{% url 'add_word' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Yeni Kelime Ekle
        </a>
        <div class="vocabulary-filters">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search words...">
                <button class="btn btn-primary" id="searchButton">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="filter-options">
                <select id="difficultyFilter">
                    <option value="">All Difficulties</option>
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard">Hard</option>
                </select>
                <select id="statusFilter">
                    <option value="">All Status</option>
                    <option value="learned">Learned</option>
                    <option value="learning">Learning</option>
                </select>
                <select id="sortFilter">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="a-z">A-Z</option>
                    <option value="z-a">Z-A</option>
                </select>
            </div>
        </div>
    </div>

    <div class="view-toggle fadeIn delay-200">
        <button class="view-btn active" data-view="grid"><i class="fas fa-th-large"></i> Grid</button>
        <button class="view-btn" data-view="list"><i class="fas fa-list"></i> List</button>
    </div>

    {% if words %}
    <div class="vocabulary-list grid-view fadeIn delay-300">
        {% for word in words %}
        <div class="word-card animated-card {% if word.learned %}learned{% endif %}" data-english="{{ word.english }}" data-date="{{ word.date_added }}">
            <div class="word-header">
                <span class="word-english">{{ word.english }}</span>
                <span class="word-difficulty {{ word.difficulty }}">{{ word.difficulty }}</span>
            </div>
            <div class="word-turkish">{{ word.turkish }}</div>
            <div class="word-part">{{ word.part_of_speech }}</div>
            <div class="word-actions">
                {% if not word.learned %}
                <a href="{{ url_for('mark_learned', word_id=word.id) }}" class="btn btn-small btn-accent animated-button">
                    <i class="fas fa-check"></i> Mark as Learned
                </a>
                {% else %}
                <span class="learned-badge">
                    <i class="fas fa-check-circle"></i> Learned
                </span>
                {% endif %}
                <button class="btn btn-small btn-edit animated-button">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-small btn-delete animated-button">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            <div class="word-date">Added: {{ word.date_added.strftime('%d %b %Y') }}</div>
        </div>
        {% endfor %}
    </div>
    <div class="pagination fadeIn delay-400">
        <a href="#" class="pagination-link"><i class="fas fa-chevron-left"></i></a>
        <span class="current-page">1</span>
        <a href="#" class="pagination-link">2</a>
        <a href="#" class="pagination-link">3</a>
        <a href="#" class="pagination-link"><i class="fas fa-chevron-right"></i></a>
    </div>
    {% else %}
    <div class="empty-state fadeIn delay-300">
        <img src="{{ url_for('static', filename='images/empty-vocabulary.svg') }}" alt="Empty Vocabulary">
        <h3>Your vocabulary list is empty</h3>
        <p>Start adding words to build your personal dictionary.</p>
        <a href="{% url 'add_word' %}" class="btn btn-primary">Add Your First Word</a>
    </div>
    {% endif %}
</section>

<!-- Word Edit Modal -->
<div class="modal" id="editWordModal">
    <div class="modal-content zoomIn">
        <div class="modal-header">
            <h3><i class="fas fa-edit"></i> Edit Word</h3>
            <button class="close-modal"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <form id="editWordForm">
                <input type="hidden" id="editWordId">
                <div class="form-group">
                    <label for="editEnglish">English Word</label>
                    <input type="text" id="editEnglish" name="english" required>
                </div>
                
                <div class="form-group">
                    <label for="editTurkish">Turkish Translation</label>
                    <input type="text" id="editTurkish" name="turkish" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editPartOfSpeech">Part of Speech</label>
                        <select id="editPartOfSpeech" name="part_of_speech" required>
                            <option value="noun">Noun</option>
                            <option value="verb">Verb</option>
                            <option value="adjective">Adjective</option>
                            <option value="adverb">Adverb</option>
                            <option value="preposition">Preposition</option>
                            <option value="conjunction">Conjunction</option>
                            <option value="pronoun">Pronoun</option>
                            <option value="interjection">Interjection</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editDifficulty">Difficulty Level</label>
                        <select id="editDifficulty" name="difficulty" required>
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editExample">Example Sentence</label>
                    <textarea id="editExample" name="example" rows="2"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary animated-button" id="cancelEdit">Cancel</button>
                    <button type="submit" class="btn btn-primary animated-button">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal" id="deleteWordModal">
    <div class="modal-content zoomIn">
        <div class="modal-header">
            <h3><i class="fas fa-trash"></i> Delete Word</h3>
            <button class="close-modal"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete this word? This action cannot be undone.</p>
            <div class="word-to-delete">
                <span id="deleteWordText"></span>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary animated-button" id="cancelDelete">Cancel</button>
                <button type="button" class="btn btn-danger animated-button" id="confirmDelete">Delete</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        
        searchButton.addEventListener('click', function() {
            filterWords();
        });
        
        searchInput.addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                filterWords();
            }
        });
        
        // Filter functionality
        const difficultyFilter = document.getElementById('difficultyFilter');
        const statusFilter = document.getElementById('statusFilter');
        const sortFilter = document.getElementById('sortFilter');
        
        difficultyFilter.addEventListener('change', filterWords);
        statusFilter.addEventListener('change', filterWords);
        sortFilter.addEventListener('change', sortWords);
        
        function filterWords() {
            const searchTerm = searchInput.value.toLowerCase();
            const difficulty = difficultyFilter.value;
            const status = statusFilter.value;
            
            const wordCards = document.querySelectorAll('.word-card');
            
            wordCards.forEach(card => {
                const english = card.querySelector('.word-english').textContent.toLowerCase();
                const turkish = card.querySelector('.word-turkish').textContent.toLowerCase();
                const cardDifficulty = card.querySelector('.word-difficulty').textContent.toLowerCase();
                const isLearned = card.classList.contains('learned');
                
                let showCard = true;
                
                // Search term filter
                if (searchTerm && !english.includes(searchTerm) && !turkish.includes(searchTerm)) {
                    showCard = false;
                }
                
                // Difficulty filter
                if (difficulty && cardDifficulty !== difficulty) {
                    showCard = false;
                }
                
                // Status filter
                if (status === 'learned' && !isLearned) {
                    showCard = false;
                } else if (status === 'learning' && isLearned) {
                    showCard = false;
                }
                
                card.style.display = showCard ? '' : 'none';
            });
            
            // Sort after filtering
            sortWords();
        }
        
        function sortWords() {
            const sortOption = sortFilter.value;
            const wordList = document.querySelector('.vocabulary-list');
            const wordCards = Array.from(wordList.querySelectorAll('.word-card:not([style*="display: none"])'));
            
            wordCards.sort((a, b) => {
                if (sortOption === 'newest') {
                    return new Date(b.dataset.date) - new Date(a.dataset.date);
                } else if (sortOption === 'oldest') {
                    return new Date(a.dataset.date) - new Date(b.dataset.date);
                } else if (sortOption === 'a-z') {
                    return a.dataset.english.localeCompare(b.dataset.english);
                } else if (sortOption === 'z-a') {
                    return b.dataset.english.localeCompare(a.dataset.english);
                }
            });
            
            wordCards.forEach(card => {
                wordList.appendChild(card);
            });
        }
        
        // View toggle functionality
        const viewButtons = document.querySelectorAll('.view-btn');
        const vocabularyList = document.querySelector('.vocabulary-list');
        
        viewButtons.forEach(button => {
            button.addEventListener('click', function() {
                const viewType = this.dataset.view;
                
                // Update active button
                viewButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Update view
                vocabularyList.className = 'vocabulary-list ' + viewType + '-view fadeIn';
            });
        });
        
        // Modal functionality
        const editButtons = document.querySelectorAll('.btn-edit');
        const deleteButtons = document.querySelectorAll('.btn-delete');
        const editModal = document.getElementById('editWordModal');
        const deleteModal = document.getElementById('deleteWordModal');
        const closeButtons = document.querySelectorAll('.close-modal');
        const cancelEditButton = document.getElementById('cancelEdit');
        const cancelDeleteButton = document.getElementById('cancelDelete');
        
        // Open edit modal
        editButtons.forEach(button => {
            button.addEventListener('click', function() {
                const wordCard = this.closest('.word-card');
                const wordId = wordCard.dataset.id;
                const english = wordCard.querySelector('.word-english').textContent;
                const turkish = wordCard.querySelector('.word-turkish').textContent;
                const partOfSpeech = wordCard.querySelector('.word-part').textContent;
                const difficulty = wordCard.querySelector('.word-difficulty').textContent;
                
                // Populate form
                document.getElementById('editWordId').value = wordId;
                document.getElementById('editEnglish').value = english;
                document.getElementById('editTurkish').value = turkish;
                document.getElementById('editPartOfSpeech').value = partOfSpeech.toLowerCase();
                document.getElementById('editDifficulty').value = difficulty.toLowerCase();
                
                // Show modal
                editModal.classList.add('active');
            });
        });
        
        // Open delete modal
        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                const wordCard = this.closest('.word-card');
                const wordId = wordCard.dataset.id;
                const english = wordCard.querySelector('.word-english').textContent;
                
                // Populate modal
                document.getElementById('deleteWordText').textContent = english;
                document.getElementById('confirmDelete').dataset.id = wordId;
                
                // Show modal
                deleteModal.classList.add('active');
            });
        });
        
        // Close modals
        closeButtons.forEach(button => {
            button.addEventListener('click', function() {
                this.closest('.modal').classList.remove('active');
            });
        });
        
        cancelEditButton.addEventListener('click', function() {
            editModal.classList.remove('active');
        });
        
        cancelDeleteButton.addEventListener('click', function() {
            deleteModal.classList.remove('active');
        });
        
        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        });
    });
</script>
{% endblock %}